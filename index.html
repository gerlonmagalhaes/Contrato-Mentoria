<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contrato Digital - Mentoria Minha Primeira Vaga Internacional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .loader {
            border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #3498db;
            width: 24px; height: 24px; animation: spin 2s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { display: none; }
        .signature-wrapper {
            position: relative; width: 100%; height: 12rem;
            -moz-user-select: none; -webkit-user-select: none; -ms-user-select: none; user-select: none;
        }
        #signature-pad { position: absolute; left: 0; top: 0; width: 100%; height: 100%; }
        /* Estilo para garantir quebras de linha corretas no modal */
        #contract-content-modal p { white-space: pre-wrap; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="container bg-white w-full max-w-3xl mx-auto p-8 md:p-12 rounded-2xl shadow-lg">
        <div class="header text-center mb-8">
            <img src="https://placehold.co/200x80/3498db/white?text=My+Personal+Teacher" alt="Logo My Personal Teacher" class="mx-auto mb-4 rounded-lg">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Contrato Digital - Mentoria Minha Primeira Vaga Internacional</h1>
            <p class="text-gray-600 mt-2">Preencha, assine e baixe seu contrato de matrícula.</p>
        </div>

        <form id="contract-form">
            <div class="space-y-6">
                 <div class="form-group">
                    <label for="fullName" class="block text-sm font-medium text-gray-700 mb-1">Nome completo do aluno(a)</label>
                    <input type="text" id="fullName" name="Nome do Aluno" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition" required placeholder="Digite seu nome completo">
                </div>
                <div class="form-group">
                    <label for="cpf" class="block text-sm font-medium text-gray-700 mb-1">CPF</label>
                    <input type="text" id="cpf" name="CPF" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition" required placeholder="000.000.000-00">
                </div>
                <div class="form-group">
                    <label for="birthdate" class="block text-sm font-medium text-gray-700 mb-1">Data de Nascimento</label>
                    <input type="date" id="birthdate" name="Data de Nascimento" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition" required>
                </div>
                
                <input type="hidden" id="address" name="Endereço" value="Não Aplicável"> 

                <div class="form-group">
                    <label for="plan" class="block text-sm font-medium text-gray-700 mb-1">Plano Contratado</label>
                    <select id="plan" name="Plano Escolhido" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition bg-white" required>
                        <option value="Mentoria Minha Primeira Vaga Internacional - R$ 2.400,00" selected>Mentoria Minha Primeira Vaga Internacional - R$ 2.400,00</option>
                    </select>
                    <small class="text-gray-500 mt-1 block">Para pagamento parcelado, haverá acréscimo de 4,9%.</small>
                </div>
            </div>

            <div class="form-group mt-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Assinatura Digital</label>
                <div class="signature-wrapper border border-gray-300 rounded-lg">
                    <canvas id="signature-pad"></canvas>
                </div>
                <div class="text-right">
                    <button type="button" id="clear-signature" class="text-sm text-blue-600 hover:underline mt-2">Limpar</button>
                </div>
            </div>

            <div class="terms mt-6">
                <div class="flex items-start">
                    <input type="checkbox" id="terms" name="terms" required class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-1">
                    <label for="terms" class="ml-2 text-sm text-gray-700">Eu li e concordo com os <a href="#" id="view-contract-link" class="font-medium text-blue-600 hover:underline">termos do contrato</a>.</label>
                </div>
            </div>
            
            <button type="submit" id="submit-button" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold text-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105 mt-8 flex items-center justify-center">
                <span id="button-text">Gerar e Baixar Contrato PDF</span>
                <div id="loader" class="loader hidden ml-3"></div>
            </button>
        </form>

        <div id="status-message" class="mt-6 text-center"></div>
        
        <div id="contract-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
             <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b sticky top-0 bg-white">
                    <h2 class="text-xl font-bold">Termos do Contrato</h2>
                    <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
                </div>
                <div id="contract-content-modal" class="p-6 text-sm text-gray-700 space-y-4"></div>
                 <div class="p-4 border-t sticky bottom-0 bg-white text-right">
                    <button id="close-modal-footer" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-300">Fechar</button>
                </div>
            </div>
        </div>

        <div class="footer text-center mt-10 text-xs text-gray-500">
            <p>My Personal Teacher - Mentoria Minha Primeira Vaga Internacional</p>
            <p>+55 71 92001-2811 | cursomyteacher@gmail.com</p>
        </div>
    </div>
    
    <script>
        const { jsPDF } = window.jspdf;

        // --- DEFINIÇÃO ÚNICA DAS CLÁUSULAS (Para Modal e PDF) ---
        const contractClauses = [
            { title: 'CLÁUSULA 1 - OBJETO', text: '1.1. O presente contrato tem como objeto a prestação de serviços de mentoria online, voltada à preparação do CONTRATANTE para entrevistas de emprego em inglês para vagas internacionais.\n1.2. A mentoria inclui encontros síncronos, aulas gravadas, acompanhamento com plano de estudo personalizado e estratégias de aplicação para vagas internacionais.' },
            { title: 'CLÁUSULA 2 - DURAÇÃO DO PROGRAMA', text: '2.1. O programa de mentoria tem duração de 12 (doze) meses. A vigência inicia-se na data definida pela CONTRATADA e encerra-se automaticamente após o decurso do prazo estipulado.' },
            { title: 'CLÁUSULA 3 - RESPONSABILIDADES DO/A CONTRATANTE', text: '3.1. O sucesso do programa depende diretamente do comprometimento do/a CONTRATANTE. Para alcançar os objetivos, este deverá:\na) Participar dos encontros ao vivo agendados.\nb) Assistir às aulas gravadas disponibilizadas.\nc) Seguir o plano de estudos personalizado elaborado pelo programa.\nd) Aplicar e gravar as entrevistas para serem analisadas.\n3.2. A ausência de comprometimento nas ações acima citadas pode comprometer os resultados esperados, não sendo responsabilidade da CONTRATADA.' },
            { title: 'CLÁUSULA 4 - RESPONSABILIDADES DA CONTRATADA', text: '4.1. A CONTRATADA se compromete a fornecer os seguintes serviços durante a vigência de 12 meses:\na) Acesso a 10 (dez) módulos com mais de 50 (cinquenta) aulas preparatórias em formato de vídeo.\nb) Realização de 24 (vinte e quatro) encontros individuais de 30 (trinta) minutos cada, OU, a critério do CONTRATANTE e em comum acordo, 12 (doze) encontros individuais de 1 (uma) hora cada.\nc) Acompanhamento mensal de desempenho.\n4.2. Conteúdo e Materiais inclusos:\na)  1 e-book com perguntas e respostas comuns em entrevistas.\nc) 1 deck com palavras essenciais do inglês.\nd) 1 cronograma de estudos anual.\n4.3. Suporte e Networking: Simulação de entrevistas, análise de desempenho e acesso a grupos de networking.' },
            { title: 'CLÁUSULA 5 - POLÍTICA DE PAGAMENTO E REEMBOLSO', text: '5.1. O pagamento deve ser realizado no ato da contratação.\n5.2. O/A CONTRATANTE tem o direito de solicitar o cancelamento e o reembolso integral do valor pago em até 7 (sete) dias corridos após a confirmação do pagamento, conforme Código de Defesa do Consumidor.\n5.3. Após o período de 7 dias, o valor pago não será reembolsado. A falta de acesso às aulas ou desistência após este prazo não gera direito a reembolso, visto que o serviço estará disponível.' },
            { title: 'CLÁUSULA 6 - CONFIDENCIALIDADE E USO DE INFORMAÇÕES', text: '6.1. Todas as informações pessoais e profissionais compartilhadas serão tratadas com sigilo.\n6.2. O/A CONTRATANTE concorda que informações não confidenciais (depoimentos, dados gerais de progresso) e entrevistas gravadas com identidade protegida poderão ser utilizadas para fins educativos e de propaganda.\n6.3. Para garantir a privacidade, todas as informações utilizadas no acervo serão anonimizadas.' },
            { title: 'CLÁUSULA 7 - RESCISÃO DO CONTRATO', text: '7.1. O contrato será encerrado automaticamente ao final dos 12 (doze) meses, cessando o acesso ao conteúdo.\n7.2. A CONTRATADA poderá rescindir o contrato caso o/a CONTRATANTE não siga as condições estabelecidas, incluindo a divulgação indevida de materiais próprios do programa para terceiros.' },
            { 
                title: 'CLÁUSULA 8 - DISPOSIÇÕES FINAIS', 
                text: '8.1. Ao assinar este contrato, o/a CONTRATANTE declara que leu e concorda com os termos apresentados.\n8.2. A vigência deste Contrato e o início da prestação dos serviços dar-se-ão com a confirmação do pagamento e a disponibilização do acesso ao ambiente da mentoria. A contagem do prazo de 12 (doze) meses terá como marco inicial a data de início formalmente registrada pela CONTRATADA no cronograma de estudos compartilhado com o CONTRATANTE.\n8.3. Este contrato entra em vigor a partir da data de sua assinatura.' 
            }
        ];

        function getContractNumber() {
            // Usa uma chave diferente para a mentoria
            let contractNumber = localStorage.getItem('contractMentoriaCounter'); 
            if (!contractNumber || isNaN(parseInt(contractNumber))) {
                contractNumber = 1; 
            }
            return parseInt(contractNumber);
        }

        function incrementContractNumber() {
            let currentNumber = getContractNumber();
            currentNumber++;
            localStorage.setItem('contractMentoriaCounter', currentNumber.toString());
        }

        const viewContractLink = document.getElementById('view-contract-link');
        const contractModal = document.getElementById('contract-modal');
        const closeModalButton = document.getElementById('close-modal');
        const closeModalFooterButton = document.getElementById('close-modal-footer');
        const contractContentModal = document.getElementById('contract-content-modal');
        const cpfInput = document.getElementById('cpf');
        
        cpfInput.addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = value.slice(0, 14);
        });

        // --- FUNÇÃO PARA GERAR O CONTEÚDO HTML DO CONTRATO PARA O MODAL ---
        function getContractHtml() {
            let htmlContent = '';
            contractClauses.forEach(clause => {
                htmlContent += `<h4 class="font-bold text-base mt-4 mb-1">${clause.title}</h4>`;
                htmlContent += `<p class="text-sm text-gray-700">${clause.text}</p>`;
            });
            return htmlContent;
        }
        
        function getContractTextForModal() {
            return getContractHtml(); 
        }
        
        viewContractLink.addEventListener('click', (e) => {
            e.preventDefault();
            contractContentModal.innerHTML = getContractTextForModal();
            contractModal.classList.remove('hidden');
            contractModal.classList.add('flex');
        });

        const closeModal = () => {
            contractModal.classList.add('hidden');
            contractModal.classList.remove('flex');
        };
        closeModalButton.addEventListener('click', closeModal);
        closeModalFooterButton.addEventListener('click', closeModal);
        
        const canvas = document.getElementById('signature-pad');
        const clearSignatureButton = document.getElementById('clear-signature');
        const signaturePad = new SignaturePad(canvas, { backgroundColor: 'rgb(255, 255, 255)' });
        
        function resizeCanvas() {
            const ratio =  Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            canvas.getContext("2d").scale(ratio, ratio);
            signaturePad.fromData(signaturePad.toData());
        }
        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();

        clearSignatureButton.addEventListener('click', () => { signaturePad.clear(); });

        const form = document.getElementById('contract-form');
        const statusMessage = document.getElementById('status-message');
        const submitButton = document.getElementById('submit-button');
        const buttonText = document.getElementById('button-text');
        const loader = document.getElementById('loader');

        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            
            if (signaturePad.isEmpty()) {
                statusMessage.innerHTML = '<p class="text-red-600 font-semibold">Por favor, forneça sua assinatura no campo indicado.</p>';
                return;
            }

            buttonText.textContent = 'Gerando PDF...';
            loader.classList.remove('hidden');
            submitButton.disabled = true;
            statusMessage.innerHTML = '';

            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');

                const contractNumber = getContractNumber();
                const contractNumberFormatted = String(contractNumber).padStart(2, '0');

                // --- CAPTURA DE DADOS DO FORMULÁRIO ---
                const fullName = document.getElementById('fullName').value;
                const cpf = document.getElementById('cpf').value;
                const plan = document.getElementById('plan').value;
                const birthdateRaw = document.getElementById('birthdate').value;
                const birthdate = birthdateRaw.split('-').reverse().join('/');

                if (!fullName.trim().includes(' ')) {
                    alert('Por favor, digite seu nome completo (Nome e Sobrenome).');
                    buttonText.textContent = 'Gerar e Baixar Contrato PDF';
                    loader.classList.add('hidden');
                    submitButton.disabled = false;
                    return;
                }

                const signatureImage = signaturePad.toDataURL('image/png');
                const currentDate = new Date().toLocaleDateString('pt-BR', { day: 'numeric', month: 'long', year: 'numeric' });

                const pageHeight = pdf.internal.pageSize.height || pdf.internal.pageSize.getHeight();
                const pageWidth = pdf.internal.pageSize.width || pdf.internal.pageSize.getWidth();
                const margin = 20;
                let y = margin;

                // --- FUNÇÃO CORRIGIDA PARA ADICIONAR TEXTO (JUSTIFICADO PADRÃO) ---
                const addText = (text, options = {}) => {
                    const { size = 10, style = 'normal', align = 'justify', spaceAfter = 5 } = options;
                    
                    pdf.setFontSize(size);
                    pdf.setFont('helvetica', style);

                    const maxLineWidth = pageWidth - (margin * 2);
                    
                    const finalAlign = align === 'left' ? null : align;
                    
                    let xPos = margin;
                    if (align === 'center') {
                        // Calcula a posição central
                        xPos = pageWidth / 2;
                    } 
                    // Se for justify ou left, xPos permanece 'margin'
                    
                    const splitText = pdf.splitTextToSize(text, maxLineWidth);
                    const textHeight = splitText.length * (size * 0.35);

                    if (y + textHeight > pageHeight - margin) {
                        pdf.addPage();
                        y = margin;
                    }

                    // *** CORREÇÃO APLICADA AQUI: Garante que texto justificado/esquerda comece na margem ***
                    pdf.text(splitText, xPos, y, { align: finalAlign });
                    y += textHeight + spaceAfter;
                };

                // --- MONTAGEM DO PDF ---
                
                // 1. TÍTULO PRINCIPAL CENTRALIZADO
                addText(`CONTRATO DE MENTORIA MINHA PRIMEIRA VAGA INTERNACIONAL ${contractNumberFormatted}/2025`, { size: 12, style: 'bold', align: 'center', spaceAfter: 10 });
                
                // 2. DADOS DA CONTRATADA E CONTRATANTE (Alinhamento esquerdo)
                addText('CONTRATADA: MY PERSONAL TEACHER, pessoa jurídica de direito privado, inscrita no CNPJ/MF sob o n° 31.890.545/0001-44, com sede na Rua Boquira, 250, Jardim das Margaridas, Salvador/BA.', { style: 'bold', align: 'left', spaceAfter: 10 });
                
                addText(`CONTRATANTE: ${fullName}`, { style: 'bold', align: 'left' });
                addText(`CPF: ${cpf}`, { style: 'bold', align: 'left' });
                addText(`DATA DE NASCIMENTO: ${birthdate}`, { style: 'bold', align: 'left' });
                // ENDEREÇO REMOVIDO
                addText(`PLANO: ${plan}`, { style: 'bold', align: 'left', spaceAfter: 10 });
                
                // 3. CLÁUSULAS (Agora Justificado)
                contractClauses.forEach(clause => {
                    // Títulos das cláusulas alinhados à esquerda (padrão)
                    addText(clause.title, { style: 'bold', size: 11, spaceAfter: 3, align: 'left' });
                    // Corpo das cláusulas JUSTIFICADO
                    addText(clause.text, { size: 10, spaceAfter: 8, align: 'justify' });
                });

                // 4. ASSINATURAS (Alinhamento esquerdo)
                addText(`Salvador/BA, ${currentDate}.`, { spaceAfter: 20, align: 'left' });
                
                const signatureWidthMm = 60;
                const signatureHeightMm = 30;
                if (y + signatureHeightMm > pageHeight - margin) {
                    pdf.addPage();
                    y = margin;
                }
                pdf.addImage(signatureImage, 'PNG', margin, y, signatureWidthMm, signatureHeightMm);
                y += signatureHeightMm + 2;

                addText('_________________________', { size: 10, spaceAfter: 2, align: 'left' });
                addText(fullName, { size: 10, align: 'left' });
                addText('(CONTRATANTE)', { size: 8, align: 'left' });
                
                y += 15;
                if (y + 20 > pageHeight - margin) {
                    pdf.addPage();
                    y = margin;
                }
                addText('_________________________', { size: 10, spaceAfter: 2, align: 'left' });
                addText('GERLON DE JESUS MAGALHAES SANTOS', { size: 10, align: 'left' });
                addText('(MY PERSONAL TEACHER - CONTRATADA)', { size: 8, align: 'left' });

                pdf.save(`Contrato-Mentoria-${fullName}.pdf`);
                incrementContractNumber();

                statusMessage.innerHTML = `
                    <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-lg" role="alert">
                        <p class="font-bold">Contrato de Mentoria Gerado!</p>
                        <p class="mt-2">Envie o arquivo para nós:</p>
                        <div class="mt-4 flex flex-col sm:flex-row justify-center items-center gap-4">
                            <a href="mailto:cursomyteacher@gmail.com" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">Enviar por E-mail</a>
                            <a href="https://wa.me/5571920012811" target="_blank" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700">Enviar por WhatsApp</a>
                        </div>
                    </div>
                `;
                form.reset();
                signaturePad.clear();

            } catch (error) {
                statusMessage.innerHTML = `<p class="text-red-600 font-semibold">Ocorreu um erro ao gerar o PDF: ${error.message}</p>`;
            } finally {
                buttonText.textContent = 'Gerar e Baixar Contrato PDF';
                loader.classList.add('hidden');
                submitButton.disabled = false;
            }
        });
    </script>
</body>
</html>
